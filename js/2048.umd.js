/*
 * @LastEditors: aFei
 * @LastEditTime: 2022-12-05 17:06:19
*/
(function(e){typeof define=="function"&&define.amd?define(e):e()})(function(){"use strict";var e={data:null,RN:4,CN:4,score:0,sts:1,RUNNING:1,GAMEOVER:0,final:null,startX:null,startY:null,endX:null,endY:null,maxHeight:null,itHeight:parseInt($(".game").css("height")),start:function(){this.sizeChange(),this.historyScore(),this.sts=this.RUNNING,this.data=[];for(var i=0;i<this.RN;i++){this.data.push([]);for(var t=0;t<this.CN;t++)this.data[i][t]=0}this.randomNum(),this.randomNum(),this.randomNum(),this.updateView(),$(".end-pop a").on("click",function(a){a.preventDefault(),e.start(),$(".end-pop").removeClass("show"),$(".score").text(0)}),this.sts===1&&(document.onkeydown=function(a){switch(a.keyCode){case 37:this.moveLeft();break;case 38:this.moveTop();break;case 39:this.moveRight();break;case 40:this.moveBottom();break}}.bind(this),$("body").on("touchstart",function(a){a.preventDefault(),a.stopPropagation(),this.startX=a.originalEvent.changedTouches[0].pageX,this.startY=a.originalEvent.changedTouches[0].pageY}.bind(this)),$("body").on("touchmove",function(a){a.preventDefault(),a.stopPropagation(),this.endX=a.originalEvent.changedTouches[0].pageX,this.endY=a.originalEvent.changedTouches[0].pageY}.bind(this)),$("body").on("touchend",function(a){a.preventDefault(),a.stopPropagation(),this.checkDirection()}.bind(this)))},sizeChange:function(){window.innerHeight?this.maxHeight=window.innerHeight:document.body&&document.body.clientHeight&&(this.maxHeight=document.body.clientHeight),$("body").css("height",this.maxHeight),$(".game").css("top",this.maxHeight/2-this.itHeight/2)},historyScore:function(){localStorage.getItem("my_2048_score")?this.final=parseInt(localStorage.getItem("my_2048_score")):this.final=0,$(".maxScore").text(this.final)},checkDirection:function(){var i=this.endX-this.startX,t=this.endY-this.startY,a;switch(Math.abs(i)<10&&Math.abs(t)<10?a=0:i>0?t>0?i>t?a=4:i<t?a=2:a=Math.random()<.5?4:2:(t=Math.abs(t),i>t?a=4:i<t?a=1:a=Math.random()<.5?4:1):(i=Math.abs(i),t>0?i>t?a=3:i<t?a=2:a=Math.random()<.5?3:2:(t=Math.abs(t),i>t?a=3:i<t?a=1:a=Math.random()<.5?3:1)),a){case 0:break;case 1:this.moveTop();break;case 2:this.moveBottom();break;case 3:this.moveLeft();break;case 4:this.moveRight();break}},randomNum:function(){for(;;){var i=Math.floor(Math.random()*this.RN),t=Math.floor(Math.random()*this.CN);if(this.data[i][t]===0){this.data[i][t]=Math.random()<.3?4:2;break}}},updateView:function(){for(var i=0;i<this.RN;i++)for(var t=0;t<this.CN;t++){var a=document.getElementById("c"+i+t);this.data[i][t]!==0?(a.innerHTML=this.data[i][t],a.className="cell n"+this.data[i][t]):(a.innerHTML="",a.className="cell")}},moveLeft:function(){for(var i=String(this.data),t=0;t<this.RN;t++)this.moveLeftInRow(t);var a=String(this.data);if(i!==a){this.randomNum(),this.updateView(),$(".score").text(this.score),this.score>this.final&&(this.final=this.score,$(".maxScore").text(this.final));var s=this.end();s===-1&&this.endTime()}},moveLeftInRow:function(i){for(var t=0;t<this.CN-1;t++){var a=this.leftGetNext(i,t);if(a!==-1)this.data[i][t]===this.data[i][a]?(this.data[i][t]*=2,this.data[i][a]=0,this.score+=this.data[i][t]):this.data[i][t]!==0?t+1!==a&&(this.data[i][t+1]=this.data[i][a],this.data[i][a]=0):(this.data[i][t]=this.data[i][a],this.data[i][a]=0,t--);else break}},leftGetNext:function(i,t){for(var a=t+1;a<this.CN;a++)if(this.data[i][a]!==0)return a;return-1},moveRight:function(){for(var i=String(this.data),t=0;t<this.RN;t++)this.moveRightInRow(t);var a=String(this.data);if(i!==a){this.randomNum(),this.updateView(),$(".score").text(this.score),this.score>this.final&&(this.final=this.score,$(".maxScore").text(this.final));var s=this.end();s===-1&&this.endTime()}},moveRightInRow:function(i){for(var t=this.CN-1;t>0;t--){var a=this.rightGetNext(i,t);if(a!==-1)this.data[i][t]===this.data[i][a]?(this.data[i][t]*=2,this.data[i][a]=0,this.score+=this.data[i][t]):this.data[i][t]!==0?t-1!==a&&(this.data[i][t-1]=this.data[i][a],this.data[i][a]=0):(this.data[i][t]=this.data[i][a],this.data[i][a]=0,t++);else break}},rightGetNext:function(i,t){for(var a=t-1;a>=0;a--)if(this.data[i][a]!==0)return a;return-1},moveTop:function(){for(var i=String(this.data),t=0;t<this.CN;t++)this.moveTopInRow(t);var a=String(this.data);if(i!==a){this.randomNum(),this.updateView(),$(".score").text(this.score),this.score>this.final&&(this.final=this.score,$(".maxScore").text(this.final));var s=this.end();s===-1&&this.endTime()}},moveTopInRow:function(i){for(var t=0;t<this.RN-1;t++){var a=this.topGetNext(t,i);if(a!==-1)this.data[t][i]===this.data[a][i]?(this.data[t][i]*=2,this.data[a][i]=0,this.score+=this.data[t][i]):this.data[t][i]!==0?t+1!==a&&(this.data[t+1][i]=this.data[a][i],this.data[a][i]=0):(this.data[t][i]=this.data[a][i],this.data[a][i]=0,t--);else break}},topGetNext:function(i,t){for(var a=i+1;a<this.RN;a++)if(this.data[a][t]!==0)return a;return-1},moveBottom:function(){for(var i=String(this.data),t=0;t<this.CN;t++)this.moveBottomInRow(t);var a=String(this.data);if(i!==a){this.randomNum(),this.updateView(),$(".score").text(this.score),this.score>this.final&&(this.final=this.score,$(".maxScore").text(this.final));var s=this.end();s===-1&&this.endTime()}},moveBottomInRow:function(i){for(var t=this.RN-1;t>0;t--){var a=this.bottomGetNext(t,i);if(a!==-1)this.data[t][i]===this.data[a][i]?(this.data[t][i]*=2,this.data[a][i]=0,this.score+=this.data[t][i]):this.data[t][i]!==0?t-1!==a&&(this.data[t-1][i]=this.data[a][i],this.data[a][i]=0):(this.data[t][i]=this.data[a][i],this.data[a][i]=0,t++);else break}},bottomGetNext:function(i,t){for(var a=i-1;a>=0;a--)if(this.data[a][t]!==0)return a;return-1},end:function(){for(var i=0;i<this.RN;i++)for(var t=0;t<this.CN;t++)if(this.data[i][t]!==0){if(i<3&&t<3){if(this.data[i][t]!==this.data[i+1][t]&&this.data[i][t]!==this.data[i][t+1])continue;return 0}else if(i===3&&t<3){if(this.data[i][t]!==this.data[i][t+1])continue;return 0}else if(i<3&&t===3){if(this.data[i][t]!==this.data[i+1][t])continue;return 0}}else return 0;return-1},endTime:function(){$(".score-top").text(this.score),this.score=0,this.sts=this.GAMEOVER,localStorage.setItem("my_2048_score",this.final),$(".end-pop").addClass("show")}};e.start()});